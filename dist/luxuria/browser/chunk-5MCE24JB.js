import{b as vt,c as Oe}from"./chunk-SPADI272.js";import{b as pt,c as gt,d as ft,e as ht,f as _t,g as ue}from"./chunk-V6FLTVT2.js";import{d as Ae}from"./chunk-GIH6IOUV.js";import{b as ot,c as nt,f as oe}from"./chunk-TKXQTQJV.js";import{a as Be}from"./chunk-BWKDZDJC.js";import{b as ct}from"./chunk-674KBEP4.js";import{e as re,f as se,g as le,h as ut,i as dt,j as me,k as Pe,l as ce}from"./chunk-HXXT5RSW.js";import{a as at,b as rt,d as st,l as ne}from"./chunk-O5DE62TI.js";import"./chunk-GR7DAHDU.js";import{b as U,c as z}from"./chunk-XPOLCQDK.js";import{a as mt}from"./chunk-RK5RVTEM.js";import{l as Te}from"./chunk-TAUST47P.js";import"./chunk-KV2HKO7R.js";import"./chunk-MS4AQ6UA.js";import"./chunk-3RK6DDJD.js";import"./chunk-VNT5V4M3.js";import{E as V,J as ie,K as q,L as j,N as L,s as O,t as Me,w as Ee,z as G}from"./chunk-XC6ZPLQX.js";import{b as we,c as ae}from"./chunk-YJ3Z37TG.js";import{f as Z,g as T,i as Q,j as w,o as P,q as lt,z as W}from"./chunk-SE4BISY2.js";import{$a as v,Ab as B,C as tt,Za as R,cb as N,db as J,h as Ke,i as Xe,ib as it,j as Y,jb as K,nb as X,ob as ee,t as et,w as F,wb as Fe,xb as te,zb as A}from"./chunk-XJPX7IZZ.js";import"./chunk-27NP7QR4.js";import{$b as he,Ac as a,Bc as D,Cc as h,Dc as ve,Eb as E,Ec as Ye,Fc as Ze,Gc as ye,Hc as De,Ic as be,Kb as d,Mc as Qe,Nc as Je,Rc as xe,T as $,Tb as l,Tc as Ie,_b as fe,ac as _e,bc as o,cc as t,dc as _,ha as ke,hc as H,ma as He,mc as f,oc as p,qb as s,t as Re,wb as g,xa as I,ya as M,zc as Ne}from"./chunk-YI4P4L32.js";import{a as x,b as ge}from"./chunk-QDSGMOWV.js";var yt=(()=>{class n{constructor(e,r,i){this.fb=e,this.dialogRef=r,this.data=i,this.form=this.fb.group({reason:["",Ae.required],refund_status:["",Ae.required]})}submit(){this.form.valid&&this.dialogRef.close(this.form.value)}close(){this.dialogRef.close(null)}static{this.\u0275fac=function(r){return new(r||n)(g(te),g(re),g(se))}}static{this.\u0275cmp=E({type:n,selectors:[["app-cancel-booking-dialog"]],decls:30,vars:2,consts:[["mat-dialog-title",""],[3,"formGroup"],[1,"row"],[1,"col-md-12"],["appearance","outline",1,"w-100","full-width"],["matInput","","formControlName","reason","rows","4"],[1,"col-md-12","mb-3"],["formControlName","refund_status"],["value","Refunded"],["value","Processing"],["value","Pending"],["value","None"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","warn",3,"click","disabled"]],template:function(r,i){r&1&&(o(0,"h2",0),a(1,"Cancel Booking"),t(),o(2,"mat-dialog-content")(3,"p"),a(4,"Please provide a reason for cancelling this booking."),t(),o(5,"form",1)(6,"div",2)(7,"div",3)(8,"mat-form-field",4)(9,"mat-label"),a(10,"Reason"),t(),_(11,"textarea",5),t()(),o(12,"div",6)(13,"mat-form-field",4)(14,"mat-label"),a(15,"Refund Status"),t(),o(16,"mat-select",7)(17,"mat-option",8),a(18,"Refunded"),t(),o(19,"mat-option",9),a(20,"Processing"),t(),o(21,"mat-option",10),a(22,"Pending"),t(),o(23,"mat-option",11),a(24,"None"),t()()()()(),o(25,"mat-dialog-actions",12)(26,"button",13),f("click",function(){return i.close()}),a(27,"Close"),t(),o(28,"button",14),f("click",function(){return i.submit()}),a(29," Submit Cancellation "),t()()()()),r&2&&(s(5),l("formGroup",i.form),s(23),l("disabled",i.form.invalid))},dependencies:[A,K,R,N,J,B,X,ee,ce,dt,Pe,me,q,G,O,oe,P,w,z,U,ne,T,W,ie,V,L,j,F,ue,ae,Oe],styles:[".full-width[_ngcontent-%COMP%]{width:100%!important;display:block!important}"]})}}return n})();var de=(()=>{class n{constructor(e){this.http=e,this.apiUrl="assets/data/occupancy.json",this.baseUrl=Be.baseUrl,this.urlEndPoints=Be.urlEndPoints}getOccupancy(){return this.http.get(this.apiUrl)}getOccupancyList(){return this.http.get(this.baseUrl+this.urlEndPoints.getoccupancy).pipe(Re(e=>e.data))}getRoomOccupancyCounts(){return this.http.get(this.baseUrl+this.urlEndPoints.getRoomOccupancyCounts).pipe(Re(e=>e.data))}addNewBooking(e){let r=e;return this.http.post(this.baseUrl+this.urlEndPoints.addNewBooking,r)}cancelBooking(e){let r=e;return this.http.post(this.baseUrl+this.urlEndPoints.cancelBooking,r)}editGuestPersonalDetails(e){let r=e;return this.http.post(this.baseUrl+this.urlEndPoints.editGuestPersonalDetails,r)}getPackages(){return this.http.get(this.baseUrl+this.urlEndPoints.getPackages)}getOccupants(){return this.http.get(this.baseUrl+this.urlEndPoints.getOccupants)}getAvailableRooms(){return this.http.get(this.baseUrl+this.urlEndPoints.getAvailableRooms)}static{this.\u0275fac=function(r){return new(r||n)(He(tt))}}static{this.\u0275prov=ke({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function Ft(n,c){if(n&1&&(o(0,"div")(1,"p")(2,"strong"),a(3,"Name:"),t(),a(4),t(),o(5,"p")(6,"strong"),a(7,"Address:"),t(),a(8),t(),o(9,"p")(10,"strong"),a(11,"Phone:"),t(),a(12),t(),o(13,"p")(14,"strong"),a(15,"Email:"),t(),a(16),t()()),n&2){let e=p();s(4),Ye(" ",e.roomData.guestDetails==null||e.roomData.guestDetails.personalInfo==null?null:e.roomData.guestDetails.personalInfo.title," ",e.roomData.guestDetails==null||e.roomData.guestDetails.personalInfo==null?null:e.roomData.guestDetails.personalInfo.name," ",e.roomData.guestDetails==null||e.roomData.guestDetails.personalInfo==null?null:e.roomData.guestDetails.personalInfo.surname,""),s(4),h(" ",e.roomData.guestDetails==null||e.roomData.guestDetails.personalInfo==null?null:e.roomData.guestDetails.personalInfo.address,""),s(4),h(" ",e.roomData.guestDetails==null||e.roomData.guestDetails.personalInfo==null?null:e.roomData.guestDetails.personalInfo.phone,""),s(4),h(" ",e.roomData.guestDetails==null||e.roomData.guestDetails.personalInfo==null?null:e.roomData.guestDetails.personalInfo.email,"")}}function Tt(n,c){n&1&&(o(0,"span"),a(1,"Name is required."),t())}function wt(n,c){n&1&&(o(0,"span"),a(1," Name cannot contain special characters."),t())}function Pt(n,c){if(n&1&&(o(0,"mat-error"),d(1,Tt,2,0,"span",7)(2,wt,2,0,"span",7),t()),n&2){let e=p(2);s(),l("ngIf",e.guestForm.controls.guest_name.hasError("required")),s(),l("ngIf",e.guestForm.controls.guest_name.hasError("pattern"))}}function Ot(n,c){n&1&&(o(0,"span"),a(1,"Surname is required."),t())}function Gt(n,c){n&1&&(o(0,"span"),a(1," Surname cannot contain special characters."),t())}function Rt(n,c){if(n&1&&(o(0,"mat-error"),d(1,Ot,2,0,"span",7)(2,Gt,2,0,"span",7),t()),n&2){let e=p(2);s(),l("ngIf",e.guestForm.controls.guest_surname.hasError("required")),s(),l("ngIf",e.guestForm.controls.guest_surname.hasError("pattern"))}}function Nt(n,c){n&1&&(o(0,"span"),a(1,"Phone is required."),t())}function At(n,c){n&1&&(o(0,"span"),a(1," Phone must be 10 digits."),t())}function Bt(n,c){if(n&1&&(o(0,"mat-error"),d(1,Nt,2,0,"span",7)(2,At,2,0,"span",7),t()),n&2){let e=p(2);s(),l("ngIf",e.guestForm.controls.guest_phone.hasError("required")),s(),l("ngIf",e.guestForm.controls.guest_phone.hasError("pattern"))}}function Vt(n,c){n&1&&(o(0,"span"),a(1," Invalid email"),t())}function qt(n,c){if(n&1&&(o(0,"mat-error"),d(1,Vt,2,0,"span",7),t()),n&2){let e=p(2);s(),l("ngIf",e.guestForm.controls.guest_email.hasError("email"))}}function jt(n,c){n&1&&(o(0,"div")(1,"mat-checkbox",27),a(2,"Send Invoice"),t()())}function Lt(n,c){if(n&1&&(o(0,"div",16)(1,"mat-form-field",17)(2,"mat-label"),a(3,"Title"),t(),o(4,"mat-select",18)(5,"mat-option",19),a(6,"Mr"),t(),o(7,"mat-option",20),a(8,"Mrs"),t(),o(9,"mat-option",21),a(10,"Miss"),t()()(),o(11,"mat-form-field",17)(12,"mat-label"),a(13,"Name"),t(),_(14,"input",22),d(15,Pt,3,2,"mat-error",7),t(),o(16,"mat-form-field",17)(17,"mat-label"),a(18,"Surname"),t(),_(19,"input",23),d(20,Rt,3,2,"mat-error",7),t(),o(21,"mat-form-field",17)(22,"mat-label"),a(23,"Phone"),t(),_(24,"input",24),d(25,Bt,3,2,"mat-error",7),t(),o(26,"mat-form-field",17)(27,"mat-label"),a(28,"Email"),t(),_(29,"input",25),d(30,qt,2,1,"mat-error",7),t(),o(31,"mat-form-field",17)(32,"mat-label"),a(33,"Address"),t(),_(34,"input",26),t(),d(35,jt,3,0,"div",7),t()),n&2){let e=p();s(15),l("ngIf",e.guestForm.controls.guest_name.invalid&&(e.guestForm.controls.guest_name.dirty||e.guestForm.controls.guest_name.touched)),s(5),l("ngIf",e.guestForm.controls.guest_surname.invalid&&(e.guestForm.controls.guest_surname.dirty||e.guestForm.controls.guest_surname.touched)),s(5),l("ngIf",e.guestForm.controls.guest_phone.invalid&&(e.guestForm.controls.guest_phone.dirty||e.guestForm.controls.guest_phone.touched)),s(5),l("ngIf",e.guestForm.controls.guest_email.invalid&&(e.guestForm.controls.guest_email.dirty||e.guestForm.controls.guest_email.touched)),s(5),l("ngIf",!e.isEditMode)}}var St=(()=>{class n{constructor(e,r,i,m,u,y,b){this.data=e,this.dialogRef=r,this.dialog=i,this.fb=m,this.occupancyService=u,this.toastr=y,this.bottomSheet=b,this.loading=!1,this.isEditMode=!1,this.packages=[],this.showCancelForm=!1,this.cancellationReason="",this.roomData=e.room,this.dialogTitle="Room # "+this.roomData.roomNo,this.guestForm=this.fb.group({guest_title:[""],guest_name:["",[v.required,v.pattern(/^[a-zA-Z ]*$/)]],guest_surname:["",[v.required,v.pattern(/^[a-zA-Z ]*$/)]],guest_email:["",[v.required,v.email]],guest_phone:[""],guest_address:[""],guest_invoice:[!1],checkInDate:[""],checkOutDate:[""],booking_status:[""],payment_status:[""],payment_types:[""],payment_amount:[""],special_requests:[""],package_id:[[]]})}ngOnInit(){this.loadPackages();let e=this.roomData.guestDetails;this.guestForm.patchValue({guest_title:e?.personalInfo?.title,guest_name:e?.personalInfo?.name,guest_surname:e?.personalInfo?.surname,guest_email:e?.personalInfo?.email,guest_phone:e?.personalInfo?.phone,guest_address:e?.personalInfo?.address,guest_invoice:e?.personalInfo?.invoice==="1",checkInDate:e?.reservationInfo?.checkInDate,checkOutDate:e?.reservationInfo?.checkOutDate,booking_status:e?.reservationInfo?.bookingState,payment_status:e?.reservationInfo?.paymentStatus,payment_types:e?.reservationInfo?.paymentTypes,payment_amount:e?.reservationInfo?.paymentAmount,special_requests:e?.specialRequests,package_id:[]})}closeDialog(){this.dialogRef.close()}getNumberOfNights(){let e=this.roomData.guestDetails?.reservationInfo?.checkInDate,r=this.roomData.guestDetails?.reservationInfo?.checkOutDate;if(!e||!r)return 0;let i=new Date(e),m=new Date(r);if(isNaN(i.getTime())||isNaN(m.getTime()))return 0;let u=m.getTime()-i.getTime(),y=Math.ceil(u/(1e3*60*60*24));return y>0?y:0}editGuest(){if(!this.isEditMode){this.isEditMode=!0;return}let e=ge(x({booking_reference:this.roomData.guestDetails?.reservationInfo?.bookingReference},this.guestForm.value),{guest_invoice:this.guestForm.value.guest_invoice?1:0});this.loading=!0,this.occupancyService.editGuestPersonalDetails(e).pipe($()).subscribe(r=>{r.status==="success"?(this.toastr.success("Booking updated successfully"),this.dialogRef.close(!0)):this.toastr.error("Failed to update booking"),this.loading=!1},r=>{this.toastr.error("Error sending update"),this.loading=!1})}confirmCancelBooking(){this.dialogRef.close(),this.dialog.open(yt,{width:"400px",data:{booking_reference:this.data.room.guestDetails?.reservationInfo?.bookingReference}}).afterClosed().subscribe(r=>{if(!r)return;let i=typeof r=="object"?r.reason:r,m=typeof r=="object"?r.refund_status:null,u={booking_reference:this.data.room.guestDetails?.reservationInfo?.bookingReference,cancellation_reason:i,refund_status:m};this.occupancyService.cancelBooking(u).pipe($()).subscribe(y=>{y.status==="success"?(this.toastr.success("Booking cancelled successfully."),location.reload()):this.toastr.error("Cancellation failed.")},()=>{this.toastr.error("Server error during cancellation.")})})}loadPackages(){this.occupancyService.getPackages().pipe($()).subscribe(e=>{if(e.status==="success"){this.packages=e.data;let r=(this.roomData.guestDetails?.package?.name??"").split(",").map(m=>m.trim()),i=this.packages.filter(m=>r.includes(m.package_name)).map(m=>m.id);this.guestForm.patchValue({package_id:i})}else this.toastr.warning("Failed to load packages")},e=>{this.toastr.error("Error fetching packages")})}static{this.\u0275fac=function(r){return new(r||n)(g(se),g(re),g(le),g(te),g(de),g(Te),g(vt))}}static{this.\u0275cmp=E({type:n,selectors:[["app-guest-details-dialog"]],decls:56,vars:14,consts:[[3,"ngSubmit","formGroup"],[1,"dialogContainer"],[1,"modalHeader"],[1,"avatarDetails"],[1,"modalTitle"],["mat-icon-button","","aria-label","Close dialog",1,"modal-close-button",3,"click"],["label","Personal Info"],[4,"ngIf"],["class","form-grid-2col m-t-24",4,"ngIf"],["label","Booking Info"],["label","Payment Info"],["label","Extras"],["align","end"],["mat-stroked-button","","type","submit",3,"disabled"],["mat-stroked-button","","color","warn",3,"click"],["mat-stroked-button","","type","button","mat-dialog-close",""],[1,"form-grid-2col","m-t-24"],["appearance","outline"],["formControlName","guest_title"],["value","Mr"],["value","Mrs"],["value","Miss"],["matInput","","formControlName","guest_name"],["matInput","","formControlName","guest_surname"],["matInput","","formControlName","guest_phone","maxlength","10"],["matInput","","formControlName","guest_email","type","email"],["matInput","","formControlName","guest_address"],["formControlName","guest_invoice"]],template:function(r,i){r&1&&(o(0,"form",0),f("ngSubmit",function(){return i.editGuest()}),o(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),a(5),t()(),o(6,"button",5),f("click",function(){return i.dialogRef.close()}),o(7,"mat-icon"),a(8,"close"),t()()(),o(9,"mat-dialog-content")(10,"mat-tab-group")(11,"mat-tab",6),d(12,Ft,17,6,"div",7)(13,Lt,36,5,"div",8),t(),o(14,"mat-tab",9)(15,"p")(16,"strong"),a(17,"Check-In:"),t(),a(18),t(),o(19,"p")(20,"strong"),a(21,"Check-Out:"),t(),a(22),t(),o(23,"p")(24,"strong"),a(25,"Booking Ref:"),t(),a(26),t()(),o(27,"mat-tab",10)(28,"p")(29,"strong"),a(30,"Payment Type:"),t(),a(31),t(),o(32,"p")(33,"strong"),a(34,"Payment Status:"),t(),a(35),t(),o(36,"p")(37,"strong"),a(38,"Amount:"),t(),a(39),t()(),o(40,"mat-tab",11)(41,"p")(42,"strong"),a(43,"Special Requests:"),t(),a(44),t(),o(45,"p")(46,"strong"),a(47,"Packages:"),t(),a(48),t()()()(),o(49,"mat-dialog-actions",12)(50,"button",13),a(51),t(),o(52,"button",14),f("click",function(){return i.confirmCancelBooking()}),a(53," Cancel Booking "),t(),o(54,"button",15),a(55,"Close"),t()()()()),r&2&&(l("formGroup",i.guestForm),s(5),D(i.dialogTitle),s(7),l("ngIf",!i.isEditMode),s(),l("ngIf",i.isEditMode),s(5),h(" ",i.roomData.guestDetails==null||i.roomData.guestDetails.reservationInfo==null?null:i.roomData.guestDetails.reservationInfo.checkInDate,""),s(4),h(" ",i.roomData.guestDetails==null||i.roomData.guestDetails.reservationInfo==null?null:i.roomData.guestDetails.reservationInfo.checkOutDate,""),s(4),h(" ",i.roomData.guestDetails==null||i.roomData.guestDetails.reservationInfo==null?null:i.roomData.guestDetails.reservationInfo.bookingReference,""),s(5),h(" ",i.roomData.guestDetails==null||i.roomData.guestDetails.reservationInfo==null?null:i.roomData.guestDetails.reservationInfo.paymentTypes,""),s(4),h(" ",i.roomData.guestDetails==null||i.roomData.guestDetails.reservationInfo==null?null:i.roomData.guestDetails.reservationInfo.paymentStatus,""),s(4),h(" R",i.roomData.guestDetails==null||i.roomData.guestDetails.reservationInfo==null?null:i.roomData.guestDetails.reservationInfo.paymentAmount,""),s(5),h(" ",i.roomData.guestDetails==null?null:i.roomData.guestDetails.specialRequests,""),s(4),h(" ",i.roomData.guestDetails==null||i.roomData.guestDetails.package==null?null:i.roomData.guestDetails.package.name,""),s(2),l("disabled",i.isEditMode&&i.guestForm.invalid),s(),h(" ",i.isEditMode?"Save Changes":"Edit Personal Info"," "))},dependencies:[A,K,R,N,J,Fe,B,X,ee,ce,ut,Pe,me,q,G,O,Me,oe,ot,nt,P,w,Q,z,U,ne,T,Z,W,ie,V,L,j,F,Y,ue,ae,we,Oe],styles:[".details-container[_ngcontent-%COMP%]{border-top:4px solid #ffc107;background-color:#f9f9f9;padding:20px;margin:20px auto;max-width:900px}.details-row[_ngcontent-%COMP%]{border-bottom:1px solid #e0e0e0;padding:10px 0}.details-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.full-width[_ngcontent-%COMP%]{width:100%!important;display:block!important}.form-grid-2col[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px}@media (max-width: 768px){.form-grid-2col[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return n})();var Ct=(()=>{class n{constructor(){}formatToMySQLDate(e){if(!e)return"";let r=new Date(e);if(isNaN(r.getTime()))return"";let i=r.getFullYear(),m=String(r.getMonth()+1).padStart(2,"0"),u=String(r.getDate()).padStart(2,"0");return`${i}-${m}-${u}`}formatDate(e,r="dd MMM yyyy"){let i=this.getDateFormatOptions(r),m=new Date(e);return isNaN(m.getTime())?"":m.toLocaleDateString("en-US",i)}getDateFormatOptions(e){switch(e){case"dd MMM yyyy":return{day:"2-digit",month:"short",year:"numeric"};case"MMM dd, yyyy":return{month:"short",day:"2-digit",year:"numeric"};case"yyyy-MM-dd":return{year:"numeric",month:"2-digit",day:"2-digit"};default:return{year:"numeric",month:"short",day:"2-digit"}}}getCurrentDate(){let e=new Date,r=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),m=String(e.getDate()).padStart(2,"0");return`${r}${i}${m}`}dateRangeValidator(){return e=>{let r=e.get("checkInDate")?.value,i=e.get("checkOutDate")?.value;return r&&i&&new Date(r)>=new Date(i)?{invalidDateRange:!0}:null}}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ke({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function zt(n,c){n&1&&a(0,"Guest Info")}function Wt(n,c){n&1&&(o(0,"span"),a(1,"Name is required."),t())}function $t(n,c){n&1&&(o(0,"span"),a(1," Name cannot contain special characters."),t())}function Ht(n,c){if(n&1&&(o(0,"mat-error"),d(1,Wt,2,0,"span",24)(2,$t,2,0,"span",24),t()),n&2){let e=p();s(),l("ngIf",e.guestInfoForm.controls.guest_name.hasError("required")),s(),l("ngIf",e.guestInfoForm.controls.guest_name.hasError("pattern"))}}function Yt(n,c){n&1&&(o(0,"span"),a(1,"Surname is required."),t())}function Zt(n,c){n&1&&(o(0,"span"),a(1," Surname cannot contain special characters."),t())}function Qt(n,c){if(n&1&&(o(0,"mat-error"),d(1,Yt,2,0,"span",24)(2,Zt,2,0,"span",24),t()),n&2){let e=p();s(),l("ngIf",e.guestInfoForm.controls.guest_surname.hasError("required")),s(),l("ngIf",e.guestInfoForm.controls.guest_surname.hasError("pattern"))}}function Jt(n,c){n&1&&(o(0,"span"),a(1,"Address is required."),t())}function Kt(n,c){if(n&1&&(o(0,"mat-error"),d(1,Jt,2,0,"span",24),t()),n&2){let e=p();s(),l("ngIf",e.guestInfoForm.controls.guest_address.hasError("required"))}}function Xt(n,c){n&1&&(o(0,"span"),a(1,"Phone is required."),t())}function ei(n,c){n&1&&(o(0,"span"),a(1," Phone must be 10 digits."),t())}function ti(n,c){if(n&1&&(o(0,"mat-error"),d(1,Xt,2,0,"span",24)(2,ei,2,0,"span",24),t()),n&2){let e=p();s(),l("ngIf",e.guestInfoForm.controls.guest_phone.hasError("required")),s(),l("ngIf",e.guestInfoForm.controls.guest_phone.hasError("pattern"))}}function ii(n,c){n&1&&(o(0,"span"),a(1," Invalid email"),t())}function oi(n,c){if(n&1&&(o(0,"mat-error"),d(1,ii,2,0,"span",24),t()),n&2){let e=p();s(),l("ngIf",e.guestInfoForm.controls.guest_email.hasError("email"))}}function ni(n,c){n&1&&a(0,"Booking")}function ai(n,c){n&1&&(o(0,"mat-error"),a(1,"Check-In is required"),t())}function ri(n,c){n&1&&(o(0,"mat-error"),a(1,"Check-Out is required"),t())}function si(n,c){n&1&&(o(0,"mat-error"),a(1," Check-Out date must be after Check-In date."),t())}function li(n,c){n&1&&(o(0,"span"),a(1,"(Selected as main room)"),t())}function mi(n,c){if(n&1&&(o(0,"mat-option",56),a(1),d(2,li,2,0,"span",24),t()),n&2){let e=c.$implicit,r=p();l("value",e.room_no)("disabled",e.room_no===r.data.room.roomNo),s(),ve(" Room #",e.room_no," - ",e.room_name," "),s(),l("ngIf",e.room_no===r.data.room.roomNo)}}function ci(n,c){if(n&1&&(o(0,"div",57),a(1),t()),n&2){let e,r=p();s(),ve(" You\u2019ve selected ",(e=r.bookingForm.get("roomNos"))==null?null:e.value.length," room",((e=r.bookingForm.get("roomNos"))==null?null:e.value.length)>1?"s":"",". ")}}function ui(n,c){if(n&1&&(o(0,"mat-option",58),a(1),xe(2,"number"),t()),n&2){let e=c.$implicit;l("value",e.id),s(),ve(" ",e.package_name," (R",Ie(2,3,e.package_price,"1.2-2"),") ")}}function di(n,c){n&1&&a(0,"Summary")}function pi(n,c){if(n&1&&(o(0,"div"),a(1),t()),n&2){let e=c.$implicit;s(),Ze(" Room #",e.room_no," (",e.room_name,"): ",e.nights," night",e.nights>1?"s":""," @ R",e.price,"/night = R",e.nights*e.price," ")}}function gi(n,c){if(n&1&&(o(0,"div"),a(1),xe(2,"number"),t()),n&2){let e=c.$implicit;s(),ve(" Package (",e.package_name,"): R",Ie(2,2,e.package_price,"1.2-2")," ")}}function fi(n,c){if(n&1&&(o(0,"div"),d(1,gi,3,5,"div",45),t()),n&2){let e=p();s(),l("ngForOf",e.selectedPackage)}}function hi(n,c){n&1&&a(0,"Payment")}function _i(n,c){if(n&1){let e=H();o(0,"div",31)(1,"mat-form-field",49)(2,"mat-label"),a(3,"Payment Type"),t(),o(4,"mat-select",59),f("selectionChange",function(i){I(e);let m=p();return M(m.onPaymentTypeSelect(i.value))}),o(5,"mat-option",60),a(6,"Cash"),t(),o(7,"mat-option",61),a(8,"EFT"),t(),o(9,"mat-option",62),a(10,"Voucher"),t(),o(11,"mat-option",63),a(12,"Other"),t()()()()}}function vi(n,c){if(n&1){let e=H();o(0,"div",31)(1,"mat-form-field",49)(2,"mat-label"),a(3,"Other Payment Type"),t(),o(4,"input",64),f("input",function(i){I(e);let m=p();return M(m.onOtherPaymentTypeChange(i))}),t()()()}if(n&2){let e=p();s(4),l("value",e.otherPaymentType)}}function yi(n,c){n&1&&(o(0,"div",31)(1,"mat-checkbox",65),a(2,"Send Invoice"),t()())}var kt=(()=>{class n{constructor(e,r,i,m,u,y,b){this.fb=e,this.utilsService=r,this.occupancyService=i,this.toastr=m,this.dialog=u,this.data=y,this.dialogRef=b,this.loading=!1,this.packages=[],this.occupants=[],this.showOtherPaymentInput=!1,this.otherPaymentType="",this.paymentStatus="",this.minCheckInDate=new Date,this.minCheckOutDate=null,this.totalAmountToPay=0,this.roomPrice=0,this.packagePrice=0,this.selectedPackage=[],this.allAvailableRooms=[],this.nights=1,this.selectedRoomNos=[],this.roomBreakdown=[],this.guestForm=this.fb.group({guestInfoGroup:this.fb.group({guest_title:[""],guest_name:["",[v.required,v.pattern(/^[a-zA-Z ]*$/)]],guest_surname:["",[v.required,v.pattern(/^[a-zA-Z ]*$/)]],guest_address:["",v.required],guest_phone:["",[v.required,v.pattern(/^\d{10}$/)]],guest_email:["",v.email]}),bookingGroup:this.fb.group({checkInDate:["",v.required],checkOutDate:["",v.required],roomNos:[[]],package_id:[[]],special_requests:[""]}),payment_status:["",v.required],payment_types:[""],payment_amount:[0],guest_invoice:[""]},{validators:this.utilsService.dateRangeValidator()})}get guestInfoForm(){return this.guestForm.get("guestInfoGroup")}get bookingForm(){return this.guestForm.get("bookingGroup")}ngOnInit(){this.getPackages(),this.getAvailableRooms(),this.guestForm.get("bookingGroup.checkInDate")?.valueChanges.subscribe(e=>{if(e){this.minCheckOutDate=new Date(e);let r=this.guestForm.get("bookingGroup.checkOutDate")?.value;r&&new Date(r)<this.minCheckOutDate&&this.guestForm.get("bookingGroup.checkOutDate")?.setValue("")}}),this.guestForm.get("bookingGroup.roomNos")?.valueChanges.subscribe(e=>{this.selectedRoomNos=[...new Set(e)],this.updateBookingSummary()}),this.guestForm.get("bookingGroup.package_id")?.valueChanges.subscribe(e=>{this.selectedPackage=this.packages.filter(r=>e.includes(r.id)),this.updateBookingSummary()}),this.guestForm.get("bookingGroup.checkInDate")?.valueChanges.subscribe(()=>{this.calculateNights(),this.updateBookingSummary()}),this.guestForm.get("bookingGroup.checkOutDate")?.valueChanges.subscribe(()=>{this.calculateNights(),this.updateBookingSummary()}),this.calculateNights(),this.updateBookingSummary(),this.guestForm.get("payment_status")?.valueChanges.subscribe(e=>{this.paymentStatus=e,e==="UnPaid"?(this.showOtherPaymentInput=!1,this.guestForm.get("payment_types")?.setValue(""),this.guestForm.get("payment_types")?.clearValidators(),this.guestForm.get("payment_types")?.updateValueAndValidity(),this.otherPaymentType=""):e==="Paid"&&(this.guestForm.get("payment_types")?.setValidators([v.required]),this.guestForm.get("payment_types")?.updateValueAndValidity())})}onSubmit(){if(this.guestForm.valid){this.loading=!0;let e=this.guestForm.get("guestInfoGroup").value,r=this.guestForm.get("bookingGroup").value,i=this.guestForm.get("payment_amount")?.value,m=this.guestForm.get("guest_invoice")?.value,u=this.utilsService.formatToMySQLDate(r.checkInDate),y=this.utilsService.formatToMySQLDate(r.checkOutDate),b=this.guestForm.get("payment_status")?.value,C=ge(x(x({},e),r),{checkInDate:u,checkOutDate:y,payment_amount:i,guest_invoice:m,bookingId:this.data.room.id,roomNo:this.data.room.roomNo,booking_status:"CheckIn",payment_status:b,payment_types:this.otherPaymentType||this.guestForm.get("payment_types")?.value});debugger;this.occupancyService.addNewBooking(C).pipe($()).subscribe(k=>{k.status==="success"?(this.toastr.success("Booking Added successfully!"),this.loading=!1,this.dialogRef.close(),this.dialogRef.close("refresh"),this.getAvailableRooms()):(this.toastr.error("Something went wrong. Please contact System Admin."),this.loading=!1)},k=>{this.toastr.error("Booking failed."),this.loading=!1})}}editGuest(){if(!this.isEditMode){this.isEditMode=!0;return}let e=ge(x({booking_reference:this.data.room.guestDetails?.reservationInfo?.bookingReference},this.guestForm.value),{guest_invoice:this.guestForm.value.guest_invoice?1:0});debugger;this.loading=!0,this.occupancyService.editGuestPersonalDetails(e).pipe($()).subscribe(r=>{r.status==="success"?(this.toastr.success("Guest info updated"),this.dialogRef.close(!0)):this.toastr.error("Update failed"),this.loading=!1},()=>{this.toastr.error("Server error"),this.loading=!1})}onPaymentTypeSelect(e){this.showOtherPaymentInput=e==="Other",this.showOtherPaymentInput?this.guestForm.patchValue({payment_types:""}):this.guestForm.patchValue({payment_types:e})}onOtherPaymentTypeChange(e){let r=e.target.value;this.otherPaymentType=r,this.guestForm.patchValue({payment_types:r})}getPackages(){this.occupancyService.getPackages().subscribe(e=>{e.status==="success"?this.packages=e.data:this.toastr.warning("Failed to load packages.")},e=>{console.error("[ERROR] Failed to fetch packages:",e),this.toastr.error("Something went wrong. Please contact the Super Admin.")})}getAvailableRooms(){this.occupancyService.getAvailableRooms().subscribe(e=>{this.allAvailableRooms=e.data},e=>{this.toastr.error("Could not fetch rooms")})}getRoomDetails(e){return this.allAvailableRooms.find(r=>r.room_no===e)}getSelectedRoomDetails(){return this.allAvailableRooms.filter(e=>this.selectedRoomNos.includes(e.room_no)&&e.room_no!==this.data.room.roomNo)}getRoomSummaryLabel(e){return`Room #${e.room_no} (${e.room_name}): Week: R${e.weekPrice}, Weekend: R${e.weekendPrice}`}parseFloat(e){return parseFloat(e)}onPackageSelectionChange(e){this.selectedPackage=this.packages.filter(r=>e.includes(r.id)),this.updateBookingSummary()}getNightsBetween(e,r){if(!e||!r)return 0;let i=new Date(e),u=new Date(r).getTime()-i.getTime();return u>0?Math.ceil(u/(1e3*60*60*24)):0}calculateNights(){let e=this.guestForm.get("bookingGroup.checkInDate")?.value,r=this.guestForm.get("bookingGroup.checkOutDate")?.value;this.nights=this.getNightsBetween(e,r)}getSelectedRooms(){let e=this.selectedRoomNos;return this.allAvailableRooms.filter(r=>e.includes(r.room_no))}getRoomTotal(e){return this.nights*parseFloat(e.price||0)}updateBookingSummary(){let e=this.bookingForm.get("checkInDate")?.value,r=this.bookingForm.get("checkOutDate")?.value,i=this.getNightsBetween(e,r);this.nights=i;let m=this.getDateRange(e,r);this.totalAmountToPay=0,this.packagePrice=0,this.roomPrice=0,this.roomBreakdown=[];let u=this.getSelectedRoomDetails(),b=[{room_no:this.data.room.roomNo,room_name:this.data.room.roomType,weekPrice:this.data.room.weekPrice,weekendPrice:this.data.room.weekendPrice},...u],C=new Map,k=0;for(let S of b)for(let Ce of m){let It=Ce.getDay()===0||Ce.getDay()===6,$e=this.safeParseFloat(It?S.weekendPrice:S.weekPrice);k+=$e;let Ge=S.room_no;C.has(Ge)?C.get(Ge).nights+=1:C.set(Ge,{room_no:S.room_no,room_name:S.room_name,price:$e,nights:1})}this.roomBreakdown=Array.from(C.values());let pe=this.selectedPackage.reduce((S,Ce)=>S+this.safeParseFloat(Ce.package_price),0);this.roomPrice=k,this.packagePrice=pe,this.totalAmountToPay=parseFloat((k+pe).toFixed(2)),this.guestForm.get("payment_amount")?.setValue(this.totalAmountToPay)}safeParseFloat(e){let r=parseFloat(e);return isNaN(r)?0:r}getDateRange(e,r){let i=new Date(e),m=new Date(r),u=[];for(;i<m;)u.push(new Date(i)),i.setDate(i.getDate()+1);return u}closeDialog(){this.dialogRef.close()}static{this.\u0275fac=function(r){return new(r||n)(g(te),g(Ct),g(de),g(Te),g(le),g(se),g(re))}}static{this.\u0275cmp=E({type:n,selectors:[["app-add-guest-details-dialog"]],decls:157,vars:37,consts:[["stepper",""],["picker1",""],["picker2",""],[1,"dialogContainer"],[1,"modalHeader"],[1,"avatarDetails"],[1,"modalTitle"],["mat-icon-button","","aria-label","Close dialog",1,"modal-close-button",3,"click"],["mat-dialog-content",""],["linear",""],[3,"stepControl"],[3,"formGroup"],["matStepLabel",""],[1,"row","m-t-24"],[1,"col-md-6","mb-3"],["appearance","outline",1,"w-100","full-width"],["formControlName","guest_title"],["value","Mr"],["value","Mrs"],["value","Miss"],["value","Dr"],["value","Prof"],[1,"col-md-6","mb-5"],["matInput","","formControlName","guest_name"],[4,"ngIf"],["matInput","","formControlName","guest_surname"],["matInput","","formControlName","guest_address"],["matInput","","formControlName","guest_phone","type","tel","maxlength","10"],["matInput","","formControlName","guest_email","type","email"],[1,"d-flex","justify-content-end"],["mat-stroked-button","","matStepperNext","",3,"disabled"],[1,"col-sm-6","m-b-24"],["matInput","","formControlName","checkInDate",3,"matDatepicker","min"],["matSuffix","",3,"for"],["matInput","","formControlName","checkOutDate",3,"matDatepicker","min"],[1,"col-sm-12","m-b-24"],["formControlName","roomNos","multiple",""],[3,"value","disabled",4,"ngFor","ngForOf"],["class","text-muted",4,"ngIf"],["formControlName","package_id","multiple","",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","special_requests"],[1,"d-flex","justify-content-between"],["mat-stroked-button","","matStepperPrevious",""],[1,"text-muted",2,"border","1px solid #ccc","padding","10px","border-radius","6px","font-size","0.95rem"],[4,"ngFor","ngForOf"],[2,"margin-top","10px"],["mat-stroked-button","","matStepperNext",""],[3,"ngSubmit","formGroup"],["appearance","outline",1,"w-100"],["formControlName","payment_status"],["value","Paid"],["value","UnPaid"],["class","col-sm-6 m-b-24",4,"ngIf"],["matInput","","readonly","",3,"value"],["mat-stroked-button","","color","primary","type","submit",3,"disabled"],[3,"value","disabled"],[1,"text-muted"],[3,"value"],["formControlName","payment_types",3,"selectionChange"],["value","Cash"],["value","EFT"],["value","Voucher"],["value","Other"],["matInput","",3,"input","value"],["formControlName","guest_invoice"]],template:function(r,i){if(r&1){let m=H();o(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6),a(4),t()(),o(5,"button",7),f("click",function(){return I(m),M(i.dialogRef.close())}),o(6,"mat-icon"),a(7,"close"),t()()(),o(8,"div",8)(9,"mat-horizontal-stepper",9,0)(11,"mat-step",10)(12,"form",11),d(13,zt,1,0,"ng-template",12),o(14,"div",13)(15,"div",14)(16,"mat-form-field",15)(17,"mat-label"),a(18,"Title"),t(),o(19,"mat-select",16)(20,"mat-option",17),a(21,"Mr"),t(),o(22,"mat-option",18),a(23,"Mrs"),t(),o(24,"mat-option",19),a(25,"Miss"),t(),o(26,"mat-option",20),a(27,"Dr"),t(),o(28,"mat-option",21),a(29,"Prof"),t()()()(),o(30,"div",22)(31,"mat-form-field",15)(32,"mat-label"),a(33,"Name"),t(),_(34,"input",23),d(35,Ht,3,2,"mat-error",24),t()(),o(36,"div",14)(37,"mat-form-field",15)(38,"mat-label"),a(39,"Surname"),t(),_(40,"input",25),d(41,Qt,3,2,"mat-error",24),t()(),o(42,"div",14)(43,"mat-form-field",15)(44,"mat-label"),a(45,"Address"),t(),_(46,"input",26),d(47,Kt,2,1,"mat-error",24),t()(),o(48,"div",14)(49,"mat-form-field",15)(50,"mat-label"),a(51,"Phone"),t(),_(52,"input",27),d(53,ti,3,2,"mat-error",24),t()(),o(54,"div",14)(55,"mat-form-field",15)(56,"mat-label"),a(57,"Email"),t(),_(58,"input",28),d(59,oi,2,1,"mat-error",24),t()()(),o(60,"div",29)(61,"button",30),a(62,"Next"),t()()()(),o(63,"mat-step",10)(64,"form",11),d(65,ni,1,0,"ng-template",12),o(66,"div",13)(67,"div",31)(68,"mat-form-field",15)(69,"mat-label"),a(70,"Check-In Date"),t(),_(71,"input",32)(72,"mat-datepicker-toggle",33)(73,"mat-datepicker",null,1),d(75,ai,2,0,"mat-error",24),t()(),o(76,"div",31)(77,"mat-form-field",15)(78,"mat-label"),a(79,"Check-Out Date"),t(),_(80,"input",34)(81,"mat-datepicker-toggle",33)(82,"mat-datepicker",null,2),d(84,ri,2,0,"mat-error",24)(85,si,2,0,"mat-error",24),t()(),o(86,"div",35)(87,"mat-form-field",15)(88,"mat-label"),a(89,"Add More Rooms "),t(),o(90,"mat-select",36),d(91,mi,3,5,"mat-option",37),t(),d(92,ci,2,2,"div",38),t()(),o(93,"div",35)(94,"mat-form-field",15)(95,"mat-label"),a(96,"Packages"),t(),o(97,"mat-select",39),f("selectionChange",function(y){return I(m),M(i.onPackageSelectionChange(y.value))}),d(98,ui,3,6,"mat-option",40),t()()(),o(99,"div",35)(100,"mat-form-field",15)(101,"mat-label"),a(102,"Special Requests"),t(),_(103,"textarea",41),t()()(),o(104,"div",42)(105,"button",43),a(106,"Back"),t(),o(107,"button",30),a(108,"Next"),t()()()(),o(109,"mat-step"),d(110,di,1,0,"ng-template",12),o(111,"div",13)(112,"div",35)(113,"div",44)(114,"strong"),a(115,"Booking Summary"),t(),o(116,"div"),a(117,"Number of Nights: "),o(118,"strong"),a(119),t()(),d(120,pi,2,6,"div",45)(121,fi,2,1,"div",24),o(122,"div",46)(123,"strong"),a(124),xe(125,"number"),t()()()()(),o(126,"div",42)(127,"button",43),a(128,"Back"),t(),o(129,"button",47),a(130,"Next"),t()()(),o(131,"mat-step")(132,"form",48),f("ngSubmit",function(){return I(m),M(i.onSubmit())}),d(133,hi,1,0,"ng-template",12),o(134,"div",13)(135,"div",31)(136,"mat-form-field",49)(137,"mat-label"),a(138,"Payment Status"),t(),o(139,"mat-select",50)(140,"mat-option",51),a(141,"Paid"),t(),o(142,"mat-option",52),a(143,"Unpaid"),t()()()(),d(144,_i,13,0,"div",53)(145,vi,5,1,"div",53),o(146,"div",31)(147,"mat-form-field",49)(148,"mat-label"),a(149,"Total Amount"),t(),_(150,"input",54),t()(),d(151,yi,3,0,"div",53),t(),o(152,"div",42)(153,"button",43),a(154,"Back"),t(),o(155,"button",55),a(156,"Submit"),t()()()()()()()}if(r&2){let m,u,y,b,C,k,pe=Ne(74),S=Ne(83);s(4),h("Add Guest: Room #",i.data.room.roomNo,""),s(7),l("stepControl",i.guestForm.get("guestInfoGroup")),s(),l("formGroup",i.guestInfoForm),s(23),l("ngIf",i.guestInfoForm.controls.guest_name.invalid&&(i.guestInfoForm.controls.guest_name.dirty||i.guestInfoForm.controls.guest_name.touched)),s(6),l("ngIf",i.guestInfoForm.controls.guest_surname.invalid&&(i.guestInfoForm.controls.guest_surname.dirty||i.guestInfoForm.controls.guest_surname.touched)),s(6),l("ngIf",i.guestInfoForm.controls.guest_address.invalid&&(i.guestInfoForm.controls.guest_address.dirty||i.guestInfoForm.controls.guest_address.touched)),s(6),l("ngIf",i.guestInfoForm.controls.guest_phone.invalid&&(i.guestInfoForm.controls.guest_phone.dirty||i.guestInfoForm.controls.guest_phone.touched)),s(6),l("ngIf",i.guestInfoForm.controls.guest_email.invalid&&(i.guestInfoForm.controls.guest_email.dirty||i.guestInfoForm.controls.guest_email.touched)),s(2),l("disabled",!((m=i.guestForm.get("guestInfoGroup"))!=null&&m.valid)),s(2),l("stepControl",i.bookingForm),s(),l("formGroup",i.bookingForm),s(7),l("matDatepicker",pe)("min",i.minCheckInDate),s(),l("for",pe),s(3),l("ngIf",(u=i.guestForm.get("checkInDate"))==null?null:u.hasError("required")),s(5),l("matDatepicker",S)("min",i.minCheckOutDate),s(),l("for",S),s(3),l("ngIf",(y=i.guestForm.get("checkOutDate"))==null?null:y.hasError("required")),s(),l("ngIf",i.guestForm.hasError("invalidDateRange")),s(6),l("ngForOf",i.allAvailableRooms),s(),l("ngIf",(b=i.bookingForm.get("roomNos"))==null||b.value==null?null:b.value.length),s(6),l("ngForOf",i.packages),s(9),l("disabled",!((C=i.guestForm.get("bookingGroup"))!=null&&C.valid)),s(12),D(i.nights),s(),l("ngForOf",i.roomBreakdown),s(),l("ngIf",i.selectedPackage.length>0),s(3),h("Total: R",Ie(125,34,i.totalAmountToPay,"1.2-2"),""),s(8),l("formGroup",i.guestForm),s(12),l("ngIf",i.paymentStatus==="Paid"),s(),l("ngIf",i.paymentStatus==="Paid"&&i.showOtherPaymentInput),s(5),l("value","R"+i.totalAmountToPay),s(),l("ngIf",(k=i.guestForm.get("guestInfoGroup.guest_email"))==null?null:k.value),s(4),l("disabled",!i.guestForm.valid)}},dependencies:[A,K,R,N,J,Fe,B,X,ee,ce,me,q,G,O,Me,Ee,oe,P,w,Q,z,U,ne,at,rt,st,T,Z,W,ie,V,L,j,F,Xe,Y,et,ue,gt,pt,ft,ht,_t,ae,we],styles:[".full-width[_ngcontent-%COMP%]{width:100%!important;display:block!important;margin-bottom:20px}"]})}}return n})();var Di=(n,c)=>({"badge-solid-orange":n,"badge-solid-green":c}),bi=n=>({"disabled-link":n});function Si(n,c){if(n&1&&(o(0,"mat-option",7),a(1),t()),n&2){let e=c.$implicit;l("value",e),s(),D(e)}}function Ci(n,c){if(n&1&&(o(0,"mat-option",7),a(1),t()),n&2){let e=c.$implicit;l("value",e),s(),D(e)}}function ki(n,c){if(n&1&&(o(0,"mat-option",7),a(1),t()),n&2){let e=c.$implicit;l("value",e),s(),D(e)}}function xi(n,c){n&1&&_(0,"mat-spinner")}function Ii(n,c){if(n&1&&(o(0,"span",43),a(1),t()),n&2){let e=p().$implicit,r=p();s(),h(" Part of ",r.getGroupSize(e.bookingReference)," rooms ")}}function Mi(n,c){if(n&1){let e=H();o(0,"div",27)(1,"div",28)(2,"div",29)(3,"div",30)(4,"div",31)(5,"h3",32),a(6,"Room"),t(),o(7,"div",33),a(8),t()(),o(9,"div",34)(10,"small",35),a(11),t()(),o(12,"h2",36),a(13),t(),o(14,"div",37)(15,"h3",38),a(16),t(),o(17,"small",39),a(18),t(),d(19,Ii,2,1,"span",40),t(),o(20,"div",41)(21,"a",42),f("click",function(){let i=I(e).$implicit,m=p();return M(i.status==="Booked"?m.openGuestDetailsDialog(i):m.openAddGuestDetailsDialog(i))}),a(22),t()()()()()()}if(n&2){let e=c.$implicit,r=p();s(7),l("ngClass",Je(9,Di,e.status==="Booked",e.status!=="Booked")),s(),h(" ",e.status," "),s(3),h("R",e.weekPrice,""),s(2),D(e.roomNo),s(3),D(e.roomType),s(2),D(e.bedType),s(),l("ngIf",r.getGroupSize(e.bookingReference)>1),s(2),l("ngClass",Qe(12,bi,e.status==="Available")),s(),h(" ",e.status==="Booked"?"Guest Details":"Add Guest"," ")}}var xt=(()=>{class n{constructor(e,r){this.occupancyService=e,this.dialog=r,this.occupancy=[],this.filteredRooms=[],this.roomTypes=[],this.bedSizes=[],this.statuses=["Booked","Available","Cancelled"],this.showOnlyGrouped=!1,this.searchText="",this.roomStats={total:0,occupied:0,free:0},this.selectedStatus="",this.selectedType="",this.selectedBed="",this.loading=!1}ngOnInit(){this.getOccupancy(),this.getRoomStats()}getOccupancy(){this.loading=!0,this.occupancyService.getOccupancyList().subscribe(e=>{let r=[...e.map(i=>x({},i))];this.occupancy=e.sort((i,m)=>+i.roomNo-+m.roomNo),this.filteredRooms=[...this.occupancy],this.roomTypes=[...new Set(this.occupancy.map(i=>i.roomType))],this.bedSizes=[...new Set(this.occupancy.map(i=>i.bedType))],this.loading=!1,this.getRoomStats()})}filterRooms(){this.filteredRooms=this.occupancy.filter(e=>{let r=this.selectedStatus?e.status===this.selectedStatus:!0,i=this.selectedType?e.roomType===this.selectedType:!0,m=this.selectedBed?e.bedType===this.selectedBed:!0,u=this.showOnlyGrouped?this.getGroupSize(e.bookingReference)>1:!0,y=this.searchText?e.roomNo?.toString().toLowerCase().includes(this.searchText.toLowerCase())||e.bookingReference?.toLowerCase().includes(this.searchText.toLowerCase())||e.status?.toLowerCase().includes(this.searchText.toLowerCase())||e.roomType?.toLowerCase().includes(this.searchText.toLowerCase())||e.bedType?.toLowerCase().includes(this.searchText.toLowerCase()):!0;return r&&i&&m&&u&&y})}clearFilters(){this.selectedStatus="",this.selectedType="",this.selectedBed="",this.searchText="",this.filterRooms()}toggleGroupedFilter(){this.showOnlyGrouped=!this.showOnlyGrouped,this.filterRooms()}getGroupSize(e){return e?this.occupancy.filter(r=>r.bookingReference===e).length:0}openGuestDetailsDialog(e){if(!e.guestDetails&&e.bookingReference){let r=this.occupancy.find(i=>i.bookingReference===e.bookingReference&&i.guestDetails);r&&(e.guestDetails=r.guestDetails)}this.dialog.open(St,{width:"40vw",maxWidth:"100vw",data:{room:e},autoFocus:!1})}openAddGuestDetailsDialog(e){this.dialog.open(kt,{width:"40vw",maxWidth:"100vw",data:{room:e}}).afterClosed().subscribe(i=>{i&&(console.log("Guest Details Submitted:",i),this.getOccupancy(),this.getRoomStats())})}getRoomStats(){this.occupancyService.getRoomOccupancyCounts().subscribe({next:e=>{console.log("res",e),e&&typeof e.total=="number"&&(this.roomStats=e)},error:e=>{console.error("Failed to fetch room stats:",e),console.log("something went wrong")}})}static{this.\u0275fac=function(r){return new(r||n)(g(de),g(le))}}static{this.\u0275cmp=E({type:n,selectors:[["app-occupancy"]],decls:69,vars:9,consts:[[1,"container","m-t-3"],[1,"filterBody"],[1,"row"],[1,"col-md-2"],["appearance","outline","subscriptSizing","dynamic",1,"example-full-width","advance-search"],["id","status",3,"ngModelChange","selectionChange","ngModel"],["value",""],[3,"value"],["id","type",3,"ngModelChange","selectionChange","ngModel"],[1,"col-md-3"],["id","bed",3,"ngModelChange","selectionChange","ngModel"],["appearance","outline",1,"search-box"],[1,"search-label"],["matInput","","placeholder","Search...",3,"ngModelChange","keyup","ngModel"],["matSuffix",""],[1,"col-md-2","d-flex","align-items-end"],["mat-flat-button","","color","primary",1,"clearbtn","m-r-20",3,"click"],["mat-flat-button","","color","accent",1,"groupby",3,"click"],["mat-icon-button","",3,"click"],[1,"room-summary","row","m-b-20"],[1,"col-md-4"],[1,"summary-card","bg-green","text-center"],[1,"f-w-500","m-t-35","p-t-35"],[1,"summary-card","bg-blue","text-center"],[1,"f-w-500","m-t-35"],[1,"summary-card","bg-gray","text-center"],[4,"ngIf"],[1,"col-md-2","col-lg-2"],[1,"room-card"],[1,"card-body"],[1,"roomCard"],[1,"top-block","d-flex","align-items-center","justify-content-between"],[1,"m-0","f-w-500"],[1,"room-badge","badge",3,"ngClass"],[1,"price"],[1,"text-muted","m-t-8","d-inline-block","price"],[1,"m-0","f-s-24"],[1,"room-details"],[1,"room-type"],[1,"text-muted","m-t-8","d-inline-block","w-full"],["class","group-badge",4,"ngIf"],[1,"roomCard-footer"],[1,"f-s-12",3,"click","ngClass"],[1,"group-badge"]],template:function(r,i){r&1&&(_(0,"app-page-header"),o(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),a(7,"Status:"),t(),o(8,"mat-select",5),be("ngModelChange",function(u){return De(i.selectedStatus,u)||(i.selectedStatus=u),u}),f("selectionChange",function(){return i.filterRooms()}),o(9,"mat-option",6),a(10,"All"),t(),he(11,Si,2,2,"mat-option",7,fe),t()()(),o(13,"div",3)(14,"mat-form-field",4)(15,"mat-label"),a(16,"Room Type:"),t(),o(17,"mat-select",8),be("ngModelChange",function(u){return De(i.selectedType,u)||(i.selectedType=u),u}),f("selectionChange",function(){return i.filterRooms()}),o(18,"mat-option",6),a(19,"All"),t(),he(20,Ci,2,2,"mat-option",7,fe),t()()(),o(22,"div",9)(23,"mat-form-field",4)(24,"mat-label"),a(25,"Bed Size:"),t(),o(26,"mat-select",10),be("ngModelChange",function(u){return De(i.selectedBed,u)||(i.selectedBed=u),u}),f("selectionChange",function(){return i.filterRooms()}),o(27,"mat-option",6),a(28,"All"),t(),he(29,ki,2,2,"mat-option",7,fe),t()()(),o(31,"div",9)(32,"mat-form-field",11)(33,"mat-label",12),a(34,"Search..."),t(),o(35,"input",13),be("ngModelChange",function(u){return De(i.searchText,u)||(i.searchText=u),u}),f("keyup",function(){return i.filterRooms()}),t(),o(36,"mat-icon",14),a(37,"search"),t()()(),o(38,"div",15)(39,"button",16),f("click",function(){return i.clearFilters()}),a(40,"Clear"),t(),o(41,"button",17),f("click",function(){return i.toggleGroupedFilter()}),a(42),t(),o(43,"button",18),f("click",function(){return i.getOccupancy()}),o(44,"mat-icon"),a(45,"refresh"),t()()()()(),o(46,"div",19)(47,"div",20)(48,"mat-card",21)(49,"div",22),a(50,"Total Rooms"),t(),o(51,"h3"),a(52),t()()(),o(53,"div",20)(54,"mat-card",23)(55,"div",24),a(56,"Occupied"),t(),o(57,"h3"),a(58),t()()(),o(59,"div",20)(60,"mat-card",25)(61,"div",24),a(62,"Free"),t(),o(63,"h3"),a(64),t()()()(),o(65,"div",2),d(66,xi,1,0,"mat-spinner",26),he(67,Mi,23,14,"div",27,fe),t()()),r&2&&(s(8),ye("ngModel",i.selectedStatus),s(3),_e(i.statuses),s(6),ye("ngModel",i.selectedType),s(3),_e(i.roomTypes),s(6),ye("ngModel",i.selectedBed),s(3),_e(i.bedSizes),s(6),ye("ngModel",i.searchText),s(7),h(" ",i.showOnlyGrouped?"Show All":"Grouped"," "),s(10),D(i.roomStats.total),s(6),D(i.roomStats.occupied),s(6),D(i.roomStats.free),s(2),l("ngIf",i.loading),s(),_e(i.filteredRooms))},dependencies:[W,lt,F,Ke,Y,mt,q,G,O,Ee,L,j,V,T,Z,A,R,N,it,z,U,P,w,Q,B,ct],styles:[".filterBody{background-color:#fff;padding:20px;margin-bottom:20px;border-radius:10px}  .advance-search .mat-mdc-form-field-infix{min-height:unset!important;padding-top:10px!important;padding-bottom:10px!important}[_nghost-%COMP%]     .search-box .mat-mdc-text-field-wrapper{height:40px!important}[_nghost-%COMP%]     .search-box .mat-mdc-form-field-flex{margin-top:-7px!important}[_nghost-%COMP%]     .search-box .mat-mdc-floating-label{height:32px}[_nghost-%COMP%]     .search-box .mat-mdc-input-element{font-size:13px!important}[_nghost-%COMP%]     .search-box .search-label{font-size:13px;top:-4px;position:relative}.group-badge[_ngcontent-%COMP%]{background-color:#f1f1f1;color:#444;padding:2px 6px;font-size:11px;border-radius:6px;margin-left:5px}.price[_ngcontent-%COMP%]{text-align:right!important}.groupby[_ngcontent-%COMP%]{margin-left:10px}"]})}}return n})();var Ko=[{path:"",component:xt}];export{Ko as OCCUPANCY_ROUTE};
