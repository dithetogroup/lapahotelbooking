<app-page-header></app-page-header>
<div class="container m-t-3">
  <!-- Filter Section -->
  <div class="filterBody">
    <div class="row">
      <div class="col-md-2">
        <mat-form-field class="example-full-width advance-search" appearance="outline" subscriptSizing="dynamic">
          <mat-label>Status:</mat-label>
          <mat-select id="status" [(ngModel)]="selectedStatus" (selectionChange)="filterRooms()">
            <mat-option value="">All</mat-option>
            @for (status of statuses; track status) {
            <mat-option [value]="status">{{ status }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-md-2">
        <mat-form-field class="example-full-width advance-search" appearance="outline" subscriptSizing="dynamic">
          <mat-label>Room Type:</mat-label>
          <mat-select id="type" [(ngModel)]="selectedType" (selectionChange)="filterRooms()">
            <mat-option value="">All</mat-option>
            @for (type of roomTypes; track type) {
            <mat-option [value]="type">{{ type }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-md-3">
        <mat-form-field class="example-full-width advance-search" appearance="outline" subscriptSizing="dynamic">
          <mat-label>Bed Size:</mat-label>
          <mat-select id="bed" [(ngModel)]="selectedBed" (selectionChange)="filterRooms()">
            <mat-option value="">All</mat-option>
            @for (bed of bedSizes; track bed) {
            <mat-option [value]="bed">{{ bed }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>

      <div class="col-md-3">
        <mat-form-field appearance="outline" class="search-box">
          <mat-label class="search-label">Search...</mat-label>
          <input matInput [(ngModel)]="searchText" (keyup)="filterRooms()" placeholder="Search...">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>


      </div>

      <div class="col-md-2 d-flex align-items-end">
        <button mat-flat-button color="primary" (click)="clearFilters()" class="clearbtn m-r-20">Clear</button>
        <button mat-flat-button color="accent" (click)="toggleGroupedFilter()" class="groupby">
          {{ showOnlyGrouped ? 'Show All' : 'Grouped' }}
        </button>
        <button mat-icon-button (click)="getOccupancy()">
          <mat-icon>refresh</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <div class="room-summary row m-b-20">
    <div class="col-md-4">
      <mat-card class="summary-card bg-green text-center">
        <div class="f-w-500 m-t-35 p-t-35">Total Rooms</div>
        <h3>{{ roomStats.total }}</h3>
      </mat-card>
    </div>
    <div class="col-md-4">
      <mat-card class="summary-card bg-blue text-center">
        <div class="f-w-500 m-t-35">Occupied</div>
        <h3>{{ roomStats.occupied }}</h3>
      </mat-card>
    </div>
    <div class="col-md-4">
      <mat-card class="summary-card bg-gray text-center">
        <div class="f-w-500 m-t-35">Free</div>
        <h3>{{ roomStats.free }}</h3>
      </mat-card>
    </div>
  </div>
  

  <!-- Room Cards Section -->
  <div class="row">
    <mat-spinner *ngIf="loading"></mat-spinner>
    @for (room of filteredRooms; track room) {
    <div class="col-md-2 col-lg-2">
      <div class="room-card">
        <div class="card-body">
          <div class="roomCard">
            <div class="top-block d-flex align-items-center justify-content-between">
              <h3 class="m-0 f-w-500">Room</h3>
              <div
                [ngClass]="{'badge-solid-orange': room.status === 'Booked', 'badge-solid-green': room.status !== 'Booked'}"
                class="room-badge badge">
                {{ room.status }}
              </div>
            </div>
            <div class="price">
              <small class="text-muted m-t-8 d-inline-block price">R{{ room.weekPrice }}</small>
            </div>
           
            <h2 class="m-0 f-s-24">{{ room.roomNo }}</h2>
            <div class="room-details">
              <h3 class="room-type">{{ room.roomType }}</h3>
              <small class="text-muted m-t-8 d-inline-block w-full">{{ room.bedType }}</small>

              <!-- <small class="text-muted m-t-8 d-inline-block w-full">
                {{ room.guestDetails ? 'Guest Added' : 'No Guest' }}
              </small> -->
              <span class="group-badge" *ngIf="getGroupSize(room.bookingReference) > 1">
                Part of {{ getGroupSize(room.bookingReference) }} rooms
              </span>
     
            </div>
            <div class="roomCard-footer">
              <a class="f-s-12" [ngClass]="{'disabled-link': room.status === 'Available'}"
                (click)="room.status === 'Booked' ? openGuestDetailsDialog(room) : openAddGuestDetailsDialog(room)">
                {{ room.status === 'Booked' ? 'Guest Details' : 'Add Guest' }}
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    }
  </div>

</div>